<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–¢—Ä–µ–Ω–∞–∂–µ—Ä –ø–∞–º º—è—Ç—ñ</title>

<style>
body{margin:0;font-family:system-ui;background:#f4f5f7}
.screen{display:none}
.screen.active{display:block}
.card{max-width:800px;margin:30px auto;background:#fff;
  border-radius:14px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
.center{text-align:center}
button{padding:12px 18px;border-radius:12px;border:0;
  background:#0a5fa5;color:#fff;font-weight:700;cursor:pointer}
input{width:100%;padding:12px;border-radius:10px;border:1px solid #ccc}
.stack{width:220px;margin:auto;border-radius:10px;overflow:hidden}
.bar{height:50px;display:flex;align-items:center;justify-content:center;
  font-weight:700;cursor:grab}
.bar.dragging{opacity:.5}
.top{display:flex;justify-content:space-between;margin-bottom:12px}
.hidden{display:none}
</style>
</head>

<body>

<!-- START -->
<div id="start" class="screen active">
  <div class="card center">
    <h2>–¢—Ä–µ–Ω–∞–∂–µ—Ä –ø–∞–º º—è—Ç—ñ</h2>
    <p>–ó–∞–ø–∞–º º—è—Ç–∞–π –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ª—å–æ—Ä—ñ–≤ (6 —Å–µ–∫—É–Ω–¥)</p>

    <input id="name" placeholder="–Ü–º º—è"><br><br>
    <input id="email" placeholder="–ü–æ—à—Ç–∞"><br><br>

    <button onclick="startGame()">–ü–æ—á–∞—Ç–∏</button>
  </div>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div class="card center">
    <div class="top">
      <div>–ë–∞–ª–∏: <b id="score">0</b></div>
      <div>–†—ñ–≤–µ–Ω—å: <b id="level">1/5</b></div>
      <div>–ß–∞—Å: <b id="time">60</b></div>
    </div>

    <h3 id="phase">–ó–∞–ø–∞–º º—è—Ç–∞–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫</h3>
    <div class="stack" id="stack"></div><br>
    <button id="checkBtn" class="hidden" onclick="check()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
  </div>
</div>

<!-- RESULT -->
<div id="result" class="screen">
  <div class="card center">
    <h2>–ì–æ—Ç–æ–≤–æ</h2>
    <p id="summary"></p>
    <button onclick="location.reload()">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</button>
  </div>
</div>

<script>
/* ===== –¢–í–û–á –î–ê–ù–Ü ===== */
const BOT_TOKEN = "8334284872:AAERmb4ewIUBrVR22xCiM30WEejhyPUlxIY";
const CHAT_ID   = "1350269784";

/* ===== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ===== */
const LEVELS = 5;
const MEM_TIME = 6000;

/* ===== –°–¢–ê–ù ===== */
let player={}, level=1, score=0;
let target=[], current=[];
let time=60, timer;
let checksTotal=0, checksCorrect=0;
let startTs;

/* ===== –ö–û–õ–¨–û–†–ò ===== */
const COLORS = [
  ["–ß–µ—Ä–≤–æ–Ω–∏–π","#ff4b4b"],["–ñ–æ–≤—Ç–∏–π","#ffd60a"],["–ó–µ–ª–µ–Ω–∏–π","#39b36b"],
  ["–°–∏–Ω—ñ–π","#3aa8ff"],["–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π","#8b5cf6"],["–†–æ–∂–µ–≤–∏–π","#ff4fd8"]
];

/* ===== –°–¢–ê–†–¢ ===== */
function startGame(){
  player.name=name.value||"-";
  player.email=email.value||"-";
  startTs=Date.now();
  show("game");

  timer=setInterval(()=>{
    time--; timeEl.textContent=time;
    if(time<=0) finish();
  },1000);

  startLevel();
}

/* ===== –†–Ü–í–ï–ù–¨ ===== */
function startLevel(){
  levelEl.textContent=level+"/5";
  scoreEl.textContent=score;
  phase.textContent="–ó–∞–ø–∞–º º—è—Ç–∞–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫";
  checkBtn.classList.add("hidden");

  target=shuffle(COLORS).slice(0,Math.min(2+level,6));
  current=[...target];
  render(target,false);

  setTimeout(()=>{
    current=shuffle(target);
    render(current,true);
    phase.textContent="–í—ñ–¥–Ω–æ–≤—ñ—Ç—å –ø–æ—Ä—è–¥–æ–∫";
    checkBtn.classList.remove("hidden");
  },MEM_TIME);
}

/* ===== RENDER ===== */
let dragEl=null;
function render(arr,drag){
  stack.innerHTML="";
  arr.forEach(c=>{
    const d=document.createElement("div");
    d.className="bar";
    d.style.background=c[1];
    d.textContent=c[0];
    d.draggable=drag;
    d.ondragstart=()=>dragEl=d;
    d.ondragover=e=>e.preventDefault();
    d.ondrop=()=>{
      const a=[...stack.children];
      const i=a.indexOf(d), j=a.indexOf(dragEl);
      current.splice(i,0,current.splice(j,1)[0]);
      render(current,true);
    };
    stack.appendChild(d);
  });
}

/* ===== –ü–ï–†–ï–í–Ü–†–ö–ê ===== */
function check(){
  checksTotal++;
  if(JSON.stringify(current)==JSON.stringify(target)){
    checksCorrect++;
    score+=10;
    level++;
    if(level>LEVELS) finish();
    else startLevel();
  }
}

/* ===== –§–Ü–ù–Ü–® + –í–Ü–î–ü–†–ê–í–ö–ê ===== */
function finish(){
  clearInterval(timer);
  const spent=Math.round((Date.now()-startTs)/1000);
  show("result");

  summary.innerHTML=`
  üë§ ${player.name}<br>
  ‚≠ê ${score} –±–∞–ª—ñ–≤<br>
  üèÅ ${Math.min(level-1,LEVELS)}/5 —Ä—ñ–≤–Ω—ñ–≤<br>
  üéØ ${checksTotal?Math.round(checksCorrect/checksTotal*100):0}%<br>
  ‚è± ${spent} —Å`;

  const text =
`üéÆ –†–ï–ó–£–õ–¨–¢–ê–¢ –¢–†–ï–ù–ê–ñ–ï–†–ê
üë§ ${player.name}
üìß ${player.email}

‚≠ê –ë–∞–ª–∏: ${score}
üèÅ –†—ñ–≤–Ω—ñ–≤: ${Math.min(level-1,LEVELS)}/5
üéØ –¢–æ—á–Ω—ñ—Å—Ç—å: ${checksTotal?Math.round(checksCorrect/checksTotal*100):0}%
‚è± –ß–∞—Å: ${spent} c`;

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      chat_id: CHAT_ID,
      text: text
    })
  });
}

/* ===== –£–¢–ò–õ–Ü–¢–ò ===== */
function shuffle(a){return a.sort(()=>Math.random()-.5);}
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ===== UI ===== */
const scoreEl=score, levelEl=level, timeEl=time;
</script>

</body>
</html>
